-- BK's InstantSteal GUI (Delta Persistent + Auto-Steal Remote)
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- Create ScreenGui
local sabinstantsteal = Instance.new("ScreenGui")
sabinstantsteal.Name = "sab instant steal"

-- Protect GUI for Delta/Synapse
if syn then
	syn.protect_gui(sabinstantsteal)
elseif gethui then
	sabinstantsteal.Parent = gethui()
else
	sabinstantsteal.Parent = CoreGui
end

sabinstantsteal.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = sabinstantsteal
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BackgroundTransparency = 0.05
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.472, 0, 0.173, 0)
MainFrame.Size = UDim2.new(0, 314, 0, 173)

local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint.Parent = MainFrame
UIAspectRatioConstraint.AspectRatio = 2.02

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0.05,0)
UICorner.Parent = MainFrame

-- Welcome Label
local WelcomeLabel = Instance.new("TextLabel")
WelcomeLabel.Name = "WelcomeLabel"
WelcomeLabel.Parent = MainFrame
WelcomeLabel.BackgroundColor3 = Color3.fromRGB(5,11,76)
WelcomeLabel.BackgroundTransparency = 0.45
WelcomeLabel.BorderSizePixel = 0
WelcomeLabel.Position = UDim2.new(0.19,0,0.057,0)
WelcomeLabel.Size = UDim2.new(0,196,0,42)
WelcomeLabel.Font = Enum.Font.SourceSansBold
WelcomeLabel.Text = "BK's InstantSteal"
WelcomeLabel.TextColor3 = Color3.fromRGB(255,255,255)
WelcomeLabel.TextScaled = true
WelcomeLabel.TextWrapped = true

local UIAspectRatioConstraint_2 = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint_2.Parent = WelcomeLabel
UIAspectRatioConstraint_2.AspectRatio = 5.12

local UICorner_2 = Instance.new("UICorner")
UICorner_2.Parent = WelcomeLabel

local UITextSizeConstraint = Instance.new("UITextSizeConstraint")
UITextSizeConstraint.Parent = WelcomeLabel
UITextSizeConstraint.MaxTextSize = 23

-- Toggle Button
local TextButton = Instance.new("TextButton")
TextButton.Parent = MainFrame
TextButton.BackgroundColor3 = Color3.fromRGB(5,11,76)
TextButton.BackgroundTransparency = 0.3
TextButton.BorderSizePixel = 0
TextButton.Position = UDim2.new(0.236,0,0.582,0)
TextButton.Size = UDim2.new(0,167,0,50)
TextButton.Font = Enum.Font.SourceSansBold
TextButton.Text = "Instant Steal: OFF"
TextButton.TextColor3 = Color3.fromRGB(255,255,255)
TextButton.TextScaled = true
TextButton.TextWrapped = true

local UICorner_3 = Instance.new("UICorner")
UICorner_3.CornerRadius = UDim.new(0.05,0)
UICorner_3.Parent = TextButton

local UITextSizeConstraint_2 = Instance.new("UITextSizeConstraint")
UITextSizeConstraint_2.Parent = TextButton
UITextSizeConstraint_2.MaxTextSize = 23

-- =========================
-- LocalScript for Toggle & Auto-Steal
-- =========================
local running = false
local enabled = false -- toggle starts OFF

-- Make button draggable
do
	local dragging = false
	local dragInput, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		buttonPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		TextButton.Position = buttonPos
	end

	TextButton.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = TextButton.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	TextButton.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- Function to fire the steal remote
local function instantSteal()
	if running then return end
	running = true

	-- Your exact remote path
	local grabRemote = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/StealsService/Grab")
	grabRemote:FireServer() -- Fire instantly

	running = false
end

-- Toggle button click
TextButton.MouseButton1Click:Connect(function()
	enabled = not enabled
	TextButton.Text = enabled and "Auto Steal: ON" or "Auto Steal: OFF"
end)

-- Listen to animal sounds
local soundsFolder = ReplicatedStorage:WaitForChild("Sounds"):WaitForChild("Animals")

local function connectSound(sound)
	if not sound:IsA("Sound") then return end
	sound.Played:Connect(function()
		if enabled then
			instantSteal()
		end
	end)
end

-- Connect existing sounds
for _, sound in ipairs(soundsFolder:GetChildren()) do
	connectSound(sound)
end

-- Connect new sounds dynamically
soundsFolder.ChildAdded:Connect(connectSound)
